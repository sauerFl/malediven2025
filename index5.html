
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Index: Mehrere verschl√ºsselte Dateien entschl√ºsseln</title>
  <style>
    body { font-family: sans-serif; padding: 2em; background: #f4faff; text-align: center; }
    input, button { margin-top: 1em; padding: 0.6em; width: 80%; max-width: 400px; }
    .file-entry { margin-top: 1em; }
    a.download { display: inline-block; margin-top: 0.5em; padding: 0.5em 1em; background: #2980b9; color: white; text-decoration: none; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>Pauschale Entschl√ºsselung: Malediven 2025 ‚Äì D+F</h1>
  <p>Gib den gemeinsamen AES-Schl√ºssel und IV ein (beide Base64), um mehrere .encrypted-Dateien zu entschl√ºsseln.</p>

  <input id="keyInput" placeholder="AES-Schl√ºssel (Base64)" /><br>
  <input id="ivInput" placeholder="IV (Base64)" /><br>
  <button id="startDecrypt">üîì Alle entschl√ºsseln</button>

  <div id="output"></div>

  <script>
    const encryptedFiles = [
      "https://arweave.net/JQ2XT34Agw4J5kMhtDumZyo_ydMdv_8lsltfnw_EldI",
      "https://arweave.net/YaijLOYlnGtboDZ193kfgJDtMGr3nBfmcwsCjU0a1yQ"
      // Weitere Links kannst du hier eintragen
    ];

    document.getElementById("startDecrypt").addEventListener("click", async () => {
      const keyBase64 = document.getElementById("keyInput").value;
      const ivBase64 = document.getElementById("ivInput").value;
      const output = document.getElementById("output");

      if (!keyBase64 || !ivBase64) {
        alert("Key und IV m√ºssen ausgef√ºllt sein!");
        return;
      }

      const keyBytes = Uint8Array.from(atob(keyBase64), c => c.charCodeAt(0));
      const iv = Uint8Array.from(atob(ivBase64), c => c.charCodeAt(0));

      const cryptoKey = await crypto.subtle.importKey(
        "raw",
        keyBytes,
        { name: "AES-CBC" },
        false,
        ["decrypt"]
      );

      output.innerHTML = "<h3>Entschl√ºsselungsergebnisse:</h3>";

      for (const fileUrl of encryptedFiles) {
        const entry = document.createElement("div");
        entry.className = "file-entry";
        entry.innerHTML = `<strong>${fileUrl}</strong><br>Lade...`;

        output.appendChild(entry);

        try {
          const response = await fetch(fileUrl);
          const encryptedBuffer = await response.arrayBuffer();

          const decrypted = await crypto.subtle.decrypt(
            { name: "AES-CBC", iv },
            cryptoKey,
            encryptedBuffer
          );

          const blob = new Blob([decrypted]);
          const url = URL.createObjectURL(blob);

          const link = document.createElement("a");
          link.href = url;
          link.download = "entschluesselt_" + fileUrl.split("/").pop() + ".bin";
          link.className = "download";
          link.textContent = "‚¨áÔ∏è Herunterladen";

          entry.innerHTML = `<strong>${fileUrl}</strong><br>`;
          entry.appendChild(link);
        } catch (err) {
          entry.innerHTML += "<br>‚ùå Entschl√ºsselung fehlgeschlagen.";
          console.error("Fehler bei", fileUrl, err);
        }
      }
    });
  </script>
</body>
</html>
